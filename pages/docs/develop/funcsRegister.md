---
title: åŠŸèƒ½å‡½æ•°æ³¨å†Œ
isShowComments: false
---

## ç®€å•è¯´æ˜

AmiyaBot åŠŸèƒ½å¼€å‘çš„å…³é”®æ¨¡å—ä¸€å…±æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ `core` æ¨¡å—ä¸‹çš„ `bot`ã€`Message`ã€`Chain`ã€‚<br>

- `bot` ä¸ºä¸»è¦å…¥å£ï¼ŒåŒ…å«äº†æ¶ˆæ¯å’Œäº‹ä»¶çš„æ³¨å†Œå™¨ï¼Œä»¥åŠä¸€äº›æ³¨å†Œå·¥å…·å‡½æ•°ã€‚
- `Message` ä¸ºæ¥æ”¶çš„æ¶ˆæ¯ä¸»ä½“ï¼Œå†…å«é¢„è§£æçš„æ¶ˆæ¯å†…å®¹ï¼Œä»¥åŠä¸€äº›ç›¸å…³æ“ä½œå‡½æ•°ã€‚Message å¯¹è±¡åœ¨æ­¤ä»…ç”¨äºå‚æ•°ç±»å‹æ³¨è§£ï¼Œä¾›ç¼–è¾‘å™¨æ™ºèƒ½æç¤ºä½¿ç”¨ï¼Œä»»ä½•æ—¶å€™ï¼Œä½ éƒ½ä¸éœ€è¦å®ä¾‹åŒ– Message å¯¹è±¡ã€‚
- `Chain` ä¸º Mirai æ¶ˆæ¯é“¾çš„åˆ›å»ºå·¥å…·ã€‚æ‰€æœ‰éœ€è¦å‘é€çš„æ¶ˆæ¯ï¼Œéƒ½å¿…é¡»ç”± Chain ç±»åˆ›å»ºã€‚æ ¸å¿ƒä¼šè°ƒç”¨ Chain ç±»çš„ build æ–¹æ³•ç”Ÿæˆ Mirai æ¶ˆæ¯é“¾ã€‚

ç¼–å†™åŠŸèƒ½å‡½æ•°çš„æ–‡ä»¶ï¼Œç»Ÿä¸€åˆ›å»ºåœ¨ `function` ç›®å½•å†…ï¼Œç›®å½•å±‚çº§ä¸é™ã€‚<br>
äº†è§£ä»¥ä¸Šå†…å®¹ï¼Œä¸‹é¢è®©æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªç®€å•çš„ç¾¤èŠåŠŸèƒ½ã€‚

## åˆ›å»ºåŠŸèƒ½å‡½æ•°æ–‡ä»¶

æˆ‘ä»¬åœ¨ `function` ç›®å½•å†…åˆ›å»ºä¸€ä¸ª `hello.py`

``` {4}
.
â””â”€â”€ functions
    â”œâ”€â”€ __init__.py
    â””â”€â”€ hello.py
```

éšåï¼Œåœ¨ `__init__.py` å†…ï¼Œæ·»åŠ åˆšåˆšæ–°å»ºçš„ `hello` æ¨¡å—ã€‚

```python {3}
from . import (
    ...
    hello
)
```

## æ³¨å†Œä¸€ä¸ªåŠŸèƒ½

#### ç¤ºä¾‹ä¸€

å½“å¯¹è¯å†…å®¹å¸¦æœ‰ `ä½ å¥½` å…³é”®å­—æ—¶ï¼Œå›å¤ `ä½ å¥½ï¼Œä¸–ç•Œ`<br>
åœ¨åˆšåˆšæ–°å»ºçš„ `hello.py` å†…ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ã€‚

```python
from core import bot, Message, Chain


@bot.on_group_message(keywords='ä½ å¥½')
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')
```

ç°åœ¨ï¼Œåœ¨ä½ çš„ç¾¤èŠé‡Œå‘é€ `é˜¿ç±³å¨…ä½ å¥½`ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ å°†ä¼šæ”¶åˆ°å¦‚ä¸‹çš„å›å¤ã€‚

<img style="width: 400px" :src="$withBase('/doc_images/hello_world_1.png')" alt="hello_world_1">

    ã€Œè¿™æ˜¯ä¸ªäººè¿ˆå‡ºçš„ä¸€å°æ­¥ï¼Œä½†å´æ˜¯äººç±»è¿ˆå‡ºçš„ä¸€å¤§æ­¥ã€‚ã€â€”â€”â€”â€” é˜¿å§†æ–¯ç‰¹æœ—

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬äº†è§£ä¸€ä¸‹ä¸Šè¿°ä»£ç çš„æ„æˆã€‚

## åŠŸèƒ½å‡½æ•°è£…é¥°å™¨

åŠŸèƒ½å‡½æ•°è£…é¥°å™¨ä½œç”¨äºä½ çš„ä¸šåŠ¡é€»è¾‘ä¸»ä½“å‡½æ•°ï¼Œå…¶é€‰æ‹©ç›‘å¬æ¥æ”¶æ¶ˆæ¯çš„ç›®æ ‡ã€‚ç›®å‰è£…é¥°å™¨åˆ†ä¸º `ç§èŠ(on_private_message)`ï¼Œ`ç¾¤èŠ(on_group_message)` å’Œ `ä¸´æ—¶èŠå¤©(on_temp_message)`

```python {5,11,17}
from core import bot


# ç§èŠ
@bot.on_private_message(...)
async def _(data):
    ...


# ç¾¤èŠ
@bot.on_group_message(...)
async def _(data):
    ...


# ä¸´æ—¶èŠå¤©
@bot.on_temp_message(...)
async def _(data):
    ...
```

#### å‚æ•°åˆ—è¡¨

| å‚æ•°å          | ç±»å‹          | é‡Šä¹‰                                 | é»˜è®¤å€¼  |
|--------------|-------------|------------------------------------|------|
| function_id  | String      | åŠŸèƒ½IDï¼Œä¸å”¯ä¸€ï¼Œä»…ç”¨äºè®°å½•è¯¥åŠŸèƒ½çš„ä½¿ç”¨æ•°é‡             ||
| keywords     | KEYWORDS    | è§¦å‘å…³é”®å­—ï¼Œæ”¯æŒå­—ç¬¦ä¸²ã€æ­£åˆ™ã€å…¨ç­‰å¥ï¼ˆequalï¼‰æˆ–ç”±å®ƒä»¬æ„æˆçš„åˆ—è¡¨ ||
| verify       | VERIFY_CORO | è‡ªå®šä¹‰æ ¡éªŒæ–¹æ³•ï¼Œå½“è¯¥å‚æ•°è¢«èµ‹å€¼æ—¶ï¼Œkeywords å°†ä¼šå¤±æ•ˆ     ||
| check_prefix | PREFIX      | æ˜¯å¦æ ¡éªŒå‰ç¼€æˆ–æŒ‡å®šéœ€è¦æ ¡éªŒçš„å‰ç¼€                   | True |
| level        | Int         | å…³é”®å­—æ ¡éªŒæˆåŠŸåå‡½æ•°çš„å€™é€‰é»˜è®¤ç­‰çº§                  | 0    |

`check_prefix` åœ¨ç§èŠå‡½æ•°ï¼ˆ`on_private_message`ï¼‰å†…é»˜è®¤å€¼ä¸º `False`

## æ¥æ”¶ä¸åŒ…å«å‰ç¼€æˆ–æŒ‡å®šå‰ç¼€çš„æ¶ˆæ¯

AmiyaBot é»˜è®¤éœ€è¦å¯¹è¯ä¸­åŒ…å«æŒ‡å®šå‰ç¼€æ‰èƒ½è¿›å…¥æ¶ˆæ¯åˆ†é…å™¨ï¼Œæˆ‘ä»¬è®¤ä¸ºæœºå™¨äººéƒ½åº”è¯¥éµå®ˆè¿™ä¸€çº¦å®šã€‚ä½†æœ‰æ—¶å€™ï¼Œäººæ€§åŒ–ä¸€ç‚¹ä¹Ÿæœªå¿…æ˜¯ä¸€ä»¶åäº‹ã€‚<br>
è®©æˆ‘ä»¬å›åˆ° [ç¤ºä¾‹ä¸€](#ç¤ºä¾‹ä¸€) ï¼Œè¦è§¦å‘ç¤ºä¾‹ä¸€çš„åŠŸèƒ½ï¼Œå¿…é¡»è¦æ±‚å¯¹è¯å†…å®¹çš„å‰ç¼€ä¸º `é˜¿ç±³å¨…` ï¼ˆæŒ‡å®šçš„å‰ç¼€ä¹‹ä¸€ï¼‰ï¼Œæˆ‘ä»¬ç¨åŠ ä¿®æ”¹ï¼Œå³å¯åœ¨å¯¹è¯æ²¡æœ‰æºå¸¦æŒ‡å®šå‰ç¼€æ—¶ï¼Œä¹Ÿèƒ½è§¦å‘åŠŸèƒ½ã€‚<br>

#### ç¤ºä¾‹äºŒ

```python {5,11}
from core import bot, Message, Chain


# åœ¨åŸæ¥çš„åŸºç¡€ä¸Šæ·»åŠ å‚æ•° check_prefix=False å¯å¿½ç•¥å‰ç¼€æ£€æŸ¥
@bot.on_group_message(keywords='ä½ å¥½', check_prefix=False)
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')


# ä¹Ÿå¯ä»¥è®©å‰ç¼€æ£€æŸ¥ä¸´æ—¶æ”¹ä¸ºä½ æŒ‡å®šçš„å•è¯
@bot.on_group_message(keywords='ä½ å¥½', check_prefix=['å…”å…”', 'ğŸ°'])
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')
```

<img style="width: 400px" :src="$withBase('/doc_images/hello_world_2.png')" alt="hello_world_2">

::: warning æ³¨æ„<br>
é™¤ç‰¹å®šç”¨æ³•ä¹‹å¤–ï¼Œä»»ä½•æ—¶å€™éƒ½æ˜¯éœ€è¦æ£€æŸ¥æŒ‡å®šå‰ç¼€ï¼
:::

## æ¥æ”¶å…¨ç­‰å¥å¼

å…¨ç­‰å¥å¼æŒ‡å¯¹è¯çš„å†…å®¹å®Œå…¨ä¸ºè®¾å®šçš„å¥å­ï¼Œå¹¶éé€šè¿‡å…³é”®è¯è§¦å‘ï¼Œä½¿ç”¨å·¥å…· `bot.equal` å³å¯è¾¾åˆ°æ•ˆæœã€‚

#### ç¤ºä¾‹ä¸‰

```python {4}
from core import bot, Message, Chain


@bot.on_group_message(keywords=bot.equal('ä½ å¥½'))
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')
```

::: tip å°æŠ€å·§<br>
ç¤ºä¾‹ä¸‰åŒæ ·ä¹Ÿèƒ½è¾¾åˆ°ç¤ºä¾‹äºŒçš„æ¥æ”¶ä¸åŒ…å«å‰ç¼€çš„æ¶ˆæ¯çš„æ•ˆæœï¼Œå› ä¸ºå…¨ç­‰å¥å¼ä¸ä¼šæ£€æŸ¥å‰ç¼€ã€‚
:::

## æ¥æ”¶ç¬¦åˆæ­£åˆ™æ£€æŸ¥çš„å¥å¼

å…³é”®è¯ä¼ å…¥ `re.compile` å¯¹è±¡ï¼Œå³å¯ä½¿ç”¨æ­£åˆ™æ£€æŸ¥ã€‚

#### ç¤ºä¾‹å››

```python {1,6}
import re

from core import bot, Message, Chain


@bot.on_group_message(keywords=re.compile(r'ä½ å¥½ï¼Œ\d+'))
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')
```

## ç»„åˆå¤šä¸ªå’Œå¤šç§å…³é”®è¯

å…³é”®å­—æ”¯æŒç”± `å­—ç¬¦ä¸²ã€æ­£åˆ™ã€å…¨ç­‰å¥` æ„æˆçš„åˆ—è¡¨ï¼Œç»„åˆä¸­åŒ…å«å…¨ç­‰å¥æ—¶ï¼Œå…¨ç­‰å¥ä¾ç„¶ä¼šæ— è§†å‰ç¼€æ£€æŸ¥ã€‚

#### ç¤ºä¾‹äº”

```python {6}
import re

from core import bot, Message, Chain


@bot.on_group_message(keywords=['ä½ å¥½', 'æ‚¨å¥½', bot.equal('ä½ å¥½'), re.compile(r'ä½ å¥½ï¼Œ(\d+)')])
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')
```

## ä¼˜å…ˆçº§

å½“å…³é”®è¯æ ¡éªŒå­˜åœ¨å†²çªæ—¶ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šä¼˜å…ˆçº§ä¾›æ¶ˆæ¯åˆ†é…å™¨é€‰æ‹©ã€‚<br>
åˆ†é…å™¨çš„å·¥ä½œåŸç†ï¼Œæ˜¯åœ¨å®Œæˆæ£€æŸ¥ä¹‹åï¼Œå°†é€šè¿‡æ ¡éªŒçš„å€™é€‰å‡½æ•°åˆ—è¡¨æŒ‰ä¼˜å…ˆçº§å€’åºæ’åºï¼Œç„¶åé€‰å–ç¬¬ä¸€ä¸ªæ‰§è¡Œã€‚<br>
æ‰€æœ‰å‡½æ•°çš„é»˜è®¤ä¼˜å…ˆçº§éƒ½ä¸º `1`ï¼Œå¦‚æœä¸æŒ‡å®šä¼˜å…ˆçº§ï¼Œåˆ†é…å™¨ä¼šæŒ‰ç…§åŠ è½½çš„å…ˆåé¡ºåºé€‰æ‹©ã€‚

#### ç¤ºä¾‹å…­

```python {7,12}
from core import bot, Message, Chain


# å¦‚æœä¸æŒ‡å®šä¼˜å…ˆçº§ï¼Œå½“å¯¹è¯å†…å®¹ä¸º "ä¸–ç•Œä½ å¥½" æ—¶ï¼Œç¬¬ä¸€ä¸ªå‡½æ•°ä¼šé¦–å…ˆé€šè¿‡æ ¡éªŒå¹¶è¾“å‡ºã€‚
# å› ä¸ºåœ¨æ¨¡å—åŠ è½½é˜¶æ®µï¼Œç¬¬ä¸€ä¸ªå‡½æ•°æ›´æ—©æ³¨å†Œå®Œæ¯•ã€‚

@bot.on_group_message(keywords='ä½ å¥½', level=1)
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')


@bot.on_group_message(keywords='ä¸–ç•Œä½ å¥½', level=2)
async def _(data: Message):
    return Chain(data).text('ä¸–ç•Œï¼Œä½ å¥½')
```

## è‡ªå®šä¹‰æ£€æŸ¥

å†…ç½®çš„æ£€æŸ¥ç»ˆç©¶å­˜åœ¨ä¸Šé™ï¼Œå¦‚æœéœ€è¦åˆ¶ä½œå¤æ‚çš„åŠŸèƒ½ï¼Œè‡ªå®šä¹‰æ£€æŸ¥å¿…ä¸å¯å°‘ã€‚<br>
è‡ªå®šä¹‰æ£€æŸ¥æ˜¯ä¸€ä¸ªåç¨‹å‡½æ•°ï¼Œå‚æ•°ä¸º Message å¯¹è±¡ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆå¿…é€‰ï¼‰ã€ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰ã€å…³é”®è¯ï¼ˆå¯é€‰ï¼‰çš„å…ƒç¥–ã€‚

```python
async def my_verify(data: Message):
    if ...:
        return True
    return False
```

åœ¨è‡ªå®šä¹‰æ£€æŸ¥é‡Œï¼Œä½ å¯ä»¥åŠ¨æ€è¾“å‡ºä¼˜å…ˆçº§çš„å€¼ã€‚

```python {3,5}
async def my_verify(data: Message):
    if ...:
        return True, 2
    elif ...:
        return True, 1
    return False
```

è¾“å‡ºå…³é”®è¯å¯å°†å…¶èµ‹å€¼åˆ° Verify å¯¹è±¡çš„ keywords å±æ€§å†…ï¼ŒVerify å¯¹è±¡æˆ‘ä»¬ä¼šåœ¨åç»­è¯¦ç»†è¯´æ˜ã€‚

```python
async def my_verify(data: Message):
    return True, 1, ['å…³é”®è¯', ...]
```

#### ç¤ºä¾‹ä¸ƒ

```python {10}
from core import bot, Message, Chain


async def my_verify(data: Message):
    if 'ä½ å¥½' in data.text:
        return True
    return False


@bot.on_group_message(verify=my_verify)
async def _(data: Message):
    return Chain(data).text('ä½ å¥½ï¼Œä¸–ç•Œ')
```

## ç»“è¯­

ç°åœ¨ï¼Œä½ å·²ç»çŸ¥é“åŠŸèƒ½çš„å„ç§åŸºæœ¬çš„æ³¨å†Œæ–¹å¼äº†ã€‚ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å»äº†è§£åŠŸèƒ½å‡½æ•°çš„å‚æ•° [Message](/docs/develop/messageObject) å¯¹è±¡ã€‚
